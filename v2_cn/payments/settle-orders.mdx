---
title: "结算"
lang: "zh-hans"
description: ""
---

您可以通过 Payment API 或 Payment Management App 对订单模式下的商户余额或开发者余额进行结算。您可以参考[金额定义与余额计算说明](/v2_cn/payments/amounts-and-balances)获取更多关于商户余额和开发者余额的说明。

## 结算方式和资金来源

### 结算方式

* **加密货币转账**（`Crypto`）：直接将资金转到已在 Cobo 录入的外部加密货币地址
* **法币出金**（`OffRamp`）：将加密货币兑换为法币并转入您在 Cobo 录入的银行账户

### 资金来源

* **商户余额结算**（`Merchant`）：从指定商户的余额中扣除结算金额。您可以在一次接口请求中结算多个商户的多笔订单。
* **开发者余额结算**（`Psp`）：从您的开发者余额中扣除结算金额。

## 接口调用流程

### 1. 查询余额

在创建结算请求前，请调用以下接口查询余额，用于确定可结算的最大金额：

- [查询商户余额](/v2/api-references/payment/list-merchant-balances)：查询指定商户的余额
- [查询开发者余额](/v2/api-references/payment/get-developer-balance)：查询您的开发者余额

对于以上两个操作，由于您要结算的是订单收入，因此需要将 `acquiring_type` 参数设置为 `Order`。

### 2. 创建结算请求

调用 [Create settlement request](/v2/api-references/payment/create-settlement-request) 创建结算请求。

#### 基础参数
* `request_id`：您提供的唯一请求 ID，用于跟踪结算请求
* `acquiring_type`：收单模式。订单模式下，您需要将该字段设置为 `Order`
* `settlement_type`：选择资金来源
  - `Merchant`：从商户余额中扣除结算金额。适用于结算指定商户的订单收入。
  - `Psp`：从开发者余额中扣除结算金额。适用于结算开发者自身的资金，如手续费等。
* `payout_channel`：选择结算方式
  - `Crypto`：加密货币转账，直接将资金转到已录入的外部加密货币地址
  - `OffRamp`：法币出金，将加密货币兑换为法币并转入已录入的银行账户

#### 结算详情参数（`settlements` 数组）

取决于资金来源和结算方式的不同，您需要指定不同的参数组合。

| 资金来源 | 结算方式 | 相关参数 |
|---------|---------|---------|
| **商户余额** | 加密货币转账 | `merchant_id`、`order_ids`、`token_id`、`crypto_address_id` |
| **商户余额** | 法币出金 | `merchant_id`、`order_ids`、`currency`、`bank_account_id` |
| **开发者余额** | 加密货币转账 | `amount`、`token_id`、`crypto_address_id` |
| **开发者余额** | 法币出金 | `amount`、`currency`、`bank_account_id` |

**参数说明：**
- `merchant_id`：商户 ID，可通过 `settlements` 数组指定多个商户
- `order_ids`：要结算的订单 ID 列表。如果这个参数为空，则会结算该商户的所有未结算订单。
- `amount`：结算金额（仅开发者余额结算时需要，商户余额结算时自动计算）
- `token_id`：加密货币 ID（如 `ETH_USDT`、`TRON_USDT`）
- `crypto_address_id`：目标加密货币地址 ID，可调用 [List crypto addresses](/v2/api-references/payment/list-crypto-addresses) 获取
- `currency`：法币币种（目前仅支持 `USD`）
- `bank_account_id`：目标银行账户 ID，可调用 [List all bank accounts](/v2/api-references/payment/list-all-bank-accounts) 获取

### 3. 完成二次确认、风控审核及交易签名

在创建结算请求后，基于您的钱包类型、提交方式和风控设置，需要完成以下操作：

- 二次确认：如您通过 Payment Management App 创建加密货币出金的结算请求，则需要在 Cobo Guard 上确认该结算请求。
- 风控审核：如果您设置了交易风控，则可能需要审核人在 Cobo Guard 上批准该结算请求。
- 交易签名：如果您使用的是 MPC 钱包，则需要移动端签名人或服务端签名人签名，方可最终完成从您的钱包提币的操作。系统将根据在线状态和其他条件自动选择一个签名人来签署交易。您需要确保至少有一个签名人在线。交易将保持 Pending 状态，直到收到必要的签名。您可以通过 Cobo Portal 查看签名人是否在线：
   1. 登录 Cobo Portal。
      - 开发环境：https://portal.dev.cobo.com/login
      - 生产环境：https://portal.cobo.com/login
   2. 点击 <img src="/v2_cn/images/guides/wallets-icon.svg" className="icon"></img> > **MPC 钱包**。
   3. 选择您的 Vault，然后点击右上角的 <img src="/v2_cn/images/guides/manage-key-share-group.svg" className="icon"></img> 图标。
   4. 在**私钥分片管理**页面，找到您的私钥分片持有者组，并查看每个私钥分片持有者旁边的状态指示器：
      - 🟢 绿点：签名人在线并准备签署交易
      - 无绿点：签名人离线，无法签署交易。

    <img src="/v2_cn/images/guides/main-group-active.png" className="screenshot_modal" alt="密钥份额管理页面显示签名人状态"/>

### 4. 跟进结算状态

* **查询结算详情**：调用 [Get settlement request information](/v2/api-references/payment/get-settlement-request-information) 查询单个结算请求详情，或调用 [List all settlement requests](/v2/api-references/payment/list-all-settlement-requests) 查询所有结算请求
* **实时状态更新**：监听 `payment.settlement.status.updated` 事件，获取结算状态的实时更新

<Tip>欢迎您[提交反馈](https://forms.zohopublic.com/cobo/form/DocumentFeedbackForm/formperma/QvLOhxJv1_JMsJ-1dleZ8Itb_7rzN-LtgvsDdxosoVI)来帮助改进我们的文档！</Tip>